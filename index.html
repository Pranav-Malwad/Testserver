<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DW3YVHNSZT"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-DW3YVHNSZT');
</script>

<!-- Google Sign-In -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
  window.onload = function () {
    google.accounts.id.initialize({
      client_id: '780834703501-jngstt0d1u5epbl8ho4d23h8eiaiklpk.apps.googleusercontent.com',
      callback: handleCredentialResponse
    });

    google.accounts.id.renderButton(
      document.getElementById("google-signin"),
      { theme: "outline", size: "large" }
    );
  };

  function handleCredentialResponse(response) {
    const credential = response.credential;
    console.log("ID Token: " + credential); // Log the ID token or send it to your server

    // Now fetch the Google Analytics data
    fetchAnalyticsData(credential);
  }

  function fetchAnalyticsData(credential) {
    gapi.load('client:auth2', initClient);

    function initClient() {
      gapi.auth2.init({
        client_id: '780834703501-jngstt0d1u5epbl8ho4d23h8eiaiklpk.apps.googleusercontent.com',
      }).then(function () {
        const auth2 = gapi.auth2.getAuthInstance();
        if (auth2.isSignedIn.get()) {
          getAnalyticsData(); // If signed in, fetch data
        } else {
          auth2.signIn().then(getAnalyticsData); // Sign in first, then fetch data
        }
      });
    }

    function getAnalyticsData() {
      gapi.client.load('analytics', 'v3', function () {
        gapi.client.analytics.data.ga.get({
          'ids': 'ga:472513290', // Replace with your actual View ID
          'start-date': '7daysAgo',
          'end-date': 'today',
          'metrics': 'ga:sessions,ga:users,ga:pageviews',
        }).then(function (response) {
          let data = response.result;
          displayAnalyticsData(data);
        }, function (error) {
          console.error('Error fetching analytics data: ', error);
        });
      });
    }

    function displayAnalyticsData(data) {
      document.getElementById('sessions').textContent = data.totalsForAllResults['ga:sessions'];
      document.getElementById('users').textContent = data.totalsForAllResults['ga:users'];
      document.getElementById('pageviews').textContent = data.totalsForAllResults['ga:pageviews'];
    }
  }
</script>
