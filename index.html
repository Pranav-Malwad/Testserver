<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <title>Testing visitors count</title>

  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <h1>Test Server (testing visitors count)</h1>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DW3YVHNSZT"></script>

  <script src="https://apis.google.com/js/api.js"></script>

  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-DW3YVHNSZT');
  </script>


<!-- <script>
document.addEventListener('DOMContentLoaded', () => {
  let visitCount = localStorage.getItem('visitCount');

  if (!visitCount) {
      visitCount = 0;
  }

  visitCount++;
  localStorage.setItem('visitCount', visitCount);


  // Update visitor count in the UI
  document.getElementById('visitorCount').textContent = visitCount;

  console.log(`You have visited this site ${visitCount} times.`);
});
</script> -->

<!-- <div class="card shadow-sm">
  <div class="card-body text-center">
    <h5 class="card-title">Visitor Count</h5>
    <p class="card-text display-4" id="visitorCount">Loading...</p>
  </div>
</div> -->

<script>
  let auth2;
  function start() {
    gapi.load('client:auth2', initClient);
  }

  // Initialize the Google API client
  function initClient() {
    gapi.auth2.init({
      client_id: 'admin-198@test-server-447503.iam.gserviceaccount.com',
    }).then(function () {
      auth2 = gapi.auth2.getAuthInstance();
      if (auth2.isSignedIn.get()) {
        getAnalyticsData(); // Fetch data if already signed in
      } else {
        auth2.signIn().then(getAnalyticsData); // Sign in and then fetch data
      }
    });
  }

  // Make API call to fetch analytics data
  function getAnalyticsData() {
    gapi.client.load('analytics', 'v3', function () {
      gapi.client.analytics.data.ga.get({
        'ids': 'ga:472513290',
        'start-date': '7daysAgo',
        'end-date': 'today',
        'metrics': 'ga:sessions,ga:users,ga:pageviews',
      }).then(function(response) {
        let data = response.result;
        displayAnalyticsData(data);
      }, function(error) {
        console.error('Error fetching analytics data: ', error);
      });
    });
  }

  // Display the fetched data
  function displayAnalyticsData(data) {
    document.getElementById('sessions').textContent = data.totalsForAllResults['ga:sessions'];
    document.getElementById('users').textContent = data.totalsForAllResults['ga:users'];
    document.getElementById('pageviews').textContent = data.totalsForAllResults['ga:pageviews'];
  }

  // Initialize the Google API client on page load
  window.onload = start;
</script>


<h1>Google Analytics Data</h1>
<p>Sessions: <span id="sessions">Loading...</span></p>
<p>Users: <span id="users">Loading...</span></p>
<p>Pageviews: <span id="pageviews">Loading...</span></p>

<!-- Bootstrap 4 JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


</body>

</html>